################################################################################
#  Code for Bluefin tuna exploit rare food resources to break food limitations #
#                                                                              #
#  Script to generate Figure 3 and Table S1 in MS                              #
#  Author: M Pilar Tugores                                                     #
#  E-mail: pilar.tugores@ieo.csic.es                                           #
#  Version: May 2024                                                           #
################################################################################


########################## (A) Functions  ######################################

#------------------------------------------------------------------------------#
#   Function to obtain the weight of the larvae (mg) from the SL (mm)          #
#------------------------------------------------------------------------------#
wgt_from_len <- function(length_mm) {
  w <- exp(length_mm * 0.9052) * 0.0008
  return(w) # in mg
}
#------------------------------------------------------------------------------#

#------------------------------------------------------------------------------#
#          Function to calculate prey ingestion                                #
#      from each three types of prey: nauplii, cladocerans, copepods           #
#------------------------------------------------------------------------------#        
larva_feeding <- function(wgt, naup_dens, copep_dens, clado_dens, no.lightlim=TRUE){
	if(no.lightlim==FALSE) Light = LightLim[hour,day]   # Day, night, dusk or dawn
  if(no.lightlim==TRUE) Light=1  # No light limitation

  # Parameters referred to tuna larvae
  length_m = log(wgt/0.0008)/905.2  
  handling=0   				# handling time =0
  swim_vel=3.*length_m*3600         # BL/s ->m/h swimming velocity (m/s) scale with BL
  msa = 4.699*((length_m*1000.)^(-1.129))  
  behav_anatomical_ratio = 0.5      # The ratio between anatomical and behavioural measures of visual detection

  # Nauplia
  naup_len =0.15*1E-3                # 
  DwNaup = 0.11*1E-03                # Dw in mg 
  vis_r_naup = 0.5*naup_len/tan(msa*0.5*pi/180)
  vis_r_naup = behav_anatomical_ratio*vis_r_naup         #m   How far away the larva detect prey
  clearance_vol_naup= 0.5*pi*(vis_r_naup^2.)*swim_vel*Light #0.5 - larva only look up 
  naup_enc = DwNaup*clearance_vol_naup*naup_dens

# Cladocera
  DwClad = 3.15*1E-03             # mgDW 
  Clad_length = 0.8*1E-3          # 
  vis_r=0.5*Clad_length/tan(msa*0.5*pi/180) 
  vis_r=behav_anatomical_ratio*vis_r          
  Clado_dens=clado_dens
  Pr_capt_clad = min(1., max(0.,(wgt - 0.018)/(0.77-0.018))) #Capture probability of cladocerans
  clearance_vol_Clad = 0.5*pi*(vis_r^2.)*swim_vel*Light #m3/h, daylight is on or off
  clado_enc = Pr_capt_clad*DwClad*clearance_vol_Clad*Clado_dens

  # Copepods
  copep_len =1.00*1E-3               #  in m
  DwCopep = 11.1*1E-03               # 
  vis_r_copep = 0.5*copep_len/tan(msa*0.5*pi/180)
  vis_r_copep = behav_anatomical_ratio*vis_r_copep      
  clearance_vol_copep= 0.5*pi*(vis_r_copep^2.)*swim_vel*Light 
  Pr_capt_copep = Pr_capt_clad
  copep_enc = Pr_capt_copep*DwCopep*clearance_vol_copep*copep_dens

  # Food encounter
  food_enc = clado_enc + naup_enc + copep_enc 
  return (food_enc) # mg DW/hour
}
#------------------------------------------------------------------------------#

#------------------------------------------------------------------------------#
#    Function to calculate specific growth rate at libitum                     #
#------------------------------------------------------------------------------#
SGR_T <- function(Temp){
  tmp <- (0.0418*Temp - 0.8355)/15  
  tmp [tmp < 0]<- 0
  return(tmp) # mg/mg hour
}
#------------------------------------------------------------------------------#

#------------------------------------------------------------------------------#
#   Function to estimate metabolic rate                                        #
#------------------------------------------------------------------------------#
metab_rate <- function(wgt,Temp){
  q10 = 2.0   
  metabol_rate = 0.404*(wgt^0.994) # in umol O2/h at 26 degr 
  metabol_rate = metabol_rate * 32*0.88 # -> ug O2 * RQprotein = 0.88
  metabol_rate = metabol_rate * 12/34 #->ug C
  metabol_rate = metabol_rate * 100/(1000*45) #-> ug C -> mg DW (mgC=45% of DW)
  metabol_rate = metabol_rate * q10^((Temp-26)/10)  # measured at 26ºC only. 
                                                      #Q10 fitted from growth
  return (metabol_rate)                                                                                   
}
#------------------------------------------------------------------------------#

#------------------------------------------------------------------------------#
#  Function to extract coefficients from linear models                         #
#------------------------------------------------------------------------------#
xval <- function(y, yval){
  a <- summary(y)$coefficients[2,1] # slope
  b <- summary(y)$coefficients[1,1] # intercept
  xval <- (yval-b)/a
  return(xval)
}
#------------------------------------------------------------------------------#


##################### (B) Simulations, Table and Figure  #######################

#--------------------------------
#  Assimilation efficiency, constant equal to 0.77 
AE=0.77
#--------------------------------

################################################################################
#  Color palettes 
mycols <- list() # Blues, Greens, Yellows, Reds, Greys
mycols [[1]] <- c("#60B7E6", "#67F0A2", "#FFDE38", "#C75D66", "#FAEA69")
mycols [[2]] <- c("#3E7694", "#56C787", "#F1C443", "#FA4353", "#F5D64D")
mycols [[3]] <- c("#2b5166", "#429867", "#FAB243", "#E02130", "#EAAC16")                       
################################################################################

#*********** Figure 3 ***************# 
#--------------------------------
# Prepare for Figure 3. 
# Specific growth rate estimated for different prey densities, 
# at three temperatures and for four different developmental stages 
#--------------------------------

# i) Prey densities
naup <- seq(0, 30000, by=100)# nauplia density
clado <- seq(0, 30, by=1)# cladocera density
copep <- seq(0, 30, by=1)# copepod density

# ii) Temperatures  (in ºC)
Temps <- c(22,25,28)  # Temperature in ºC

# iii) Four different developmental stages
# Standard length (SL, in mm) of each larval stage and colour in Fig. 3
# Larva F0: 4.8 mm (in blue)
# Larva F1: 5.7 mm (in green)
# Larva F2: 6.7 mm (in yellow)
# Larva F3: 7.5 mm (in ???  )
lengths <- c(4.8, 5.8, 6.7, 7.5)  

# Weight for each developmental stage
W <- wgt_from_len(lengths)

#********************************************#
# Somatic growth rate at libitum (laboratory)#
#********************************************#
SGRlib_T <- SGR_T(Temps) # It only depends on temperature 
metabRate_T <- as.data.frame(matrix(data=NA, nrow=3, ncol=4))
names(metabRate_T) <- paste("L", lengths, sep="")
for(k in 1:length(Temps)){
  metabRate_T[k,] <- metab_rate(wgt=W, Temps[k])
}

#**********************#
# Simulations Feeding  #
#**********************#
# Create matrix and run only for one type of prey in each
larvaFeed_naup <- as.data.frame(matrix(nrow=length(naup), ncol=length(lengths)))
larvaFeed_clado <- as.data.frame(matrix(nrow=length(clado), ncol=length(lengths)))
larvaFeed_copep <- as.data.frame(matrix(nrow=length(copep), ncol=length(lengths)))

# Only nauplia
for (i in 1:length(naup)){
  larvaFeed_naup[i,] <- larva_feeding(wgt=W, naup_dens=naup[i], 
      copep_dens=0, clado_dens=0, no.lightlim=TRUE)
} 
rm(i)

# Only cladoceran
for (i in 1:length(clado)){ 
  larvaFeed_clado[i,] <- larva_feeding(wgt=W, naup_dens=0, 
      copep_dens=0, clado_dens=clado[i], no.lightlim=TRUE)
}
rm(i)

# Only copepods
for (i in 1:length(copep)){  
  larvaFeed_copep[i,] <- larva_feeding(wgt=W, naup_dens=0, 
      copep_dens=copep[i], clado_dens=0, no.lightlim=TRUE)
}
rm(i)


#*************************************#
# Simulations of Somatic Growth Rate  #
#*************************************#
SGRf_naup_T <- list(); SGRf_clado_T <- list(); SGRf_copep_T <- list() 
for (k in 1:3){
  SGRf_naup_T [[k]] <- as.data.frame(matrix(nrow=length(naup), ncol=length(lengths)))
  SGRf_clado_T [[k]] <- as.data.frame(matrix(nrow=length(clado), ncol=length(lengths)))
  SGRf_copep_T [[k]] <- as.data.frame(matrix(nrow=length(copep), ncol=length(lengths)))
}

# Only nauplia
for (k in 1:length(Temps)) {
  for (i in 1:length(naup)){
    SGRf_naup_T [[k]] [i,] <- AE*larvaFeed_naup[i,]/W - metabRate_T[k,]/W
  }
  SGRf_naup_T[[k]] <- SGRf_naup_T[[k]]*15 # multiplied by 15 to have daily estimates
  names(SGRf_naup_T[[k]]) <- paste("SGRnaup_T", lengths, sep="_")
}

# Only cladoceran
for (k in 1:length(Temps)) {
  for (i in 1:length(clado)){
    SGRf_clado_T [[k]] [i,] <- AE*larvaFeed_clado[i,]/W - metabRate_T[k,]/W
  }
  SGRf_clado_T[[k]] <- SGRf_clado_T[[k]]*15 # multiplied by 15 to have daily estimates
  names(SGRf_clado_T[[k]]) <- paste("SGRclado_T", lengths, sep="_")
}

# Only copepods
for (k in 1:length(Temps)) {
  for (i in 1:length(copep)){
    SGRf_copep_T [[k]] [i,] <- AE*larvaFeed_copep[i,]/W - metabRate_T[k,]/W
  }
  SGRf_copep_T[[k]] <- SGRf_copep_T[[k]]*15 # multiplied by 15 to have daily estimates
  names(SGRf_copep_T[[k]]) <- paste("SGRcopep_T", lengths, sep="_")
}

#*************************************#
# Selecting data from the simulations #
#*************************************#
SG_22_naup <- cbind(SGRf_naup_T[[1]], naup)
SG_25_naup <- cbind(SGRf_naup_T[[2]], naup)
SG_28_naup <- cbind(SGRf_naup_T[[3]], naup)

SG_22_clado <- cbind(SGRf_clado_T[[1]], clado)
SG_25_clado <- cbind(SGRf_clado_T[[2]], clado)
SG_28_clado <- cbind(SGRf_clado_T[[3]], clado)

SG_22_copep <- cbind(SGRf_copep_T[[1]], copep)
SG_25_copep <- cbind(SGRf_copep_T[[2]], copep)
SG_28_copep <- cbind(SGRf_copep_T[[3]], copep)

### Maximum Y for all plots
maxY_T <- max(SGRlib_T*15) # multiplied by 15 to have daily estimates

#************************************************************#
# Linear models to estimate min. and max. growth rates:      #
#              (Data for Table S1 in MS)                     #
#************************************************************#
# Only nauplia
modF0_22_naup <- lm(SGRnaup_T_4.8~naup, data=SG_22_naup)  
modF1_22_naup <- lm(SGRnaup_T_5.8~naup, data=SG_22_naup)
modF2_22_naup <- lm(SGRnaup_T_6.7~naup, data=SG_22_naup)
modF3_22_naup <- lm(SGRnaup_T_7.5~naup, data=SG_22_naup)

modF0_25_naup <- lm(SGRnaup_T_4.8~naup, data=SG_25_naup)
modF1_25_naup <- lm(SGRnaup_T_5.8~naup, data=SG_25_naup)
modF2_25_naup <- lm(SGRnaup_T_6.7~naup, data=SG_25_naup)
modF3_25_naup <- lm(SGRnaup_T_7.5~naup, data=SG_25_naup)

modF0_28_naup <- lm(SGRnaup_T_4.8~naup, data=SG_28_naup)
modF1_28_naup <- lm(SGRnaup_T_5.8~naup, data=SG_28_naup)
modF2_28_naup <- lm(SGRnaup_T_6.7~naup, data=SG_28_naup)
modF3_28_naup <- lm(SGRnaup_T_7.5~naup, data=SG_28_naup)

# Only cladocera
modF0_22_clado <- lm(SGRclado_T_4.8~clado, data=SG_22_clado)  
modF1_22_clado <- lm(SGRclado_T_5.8~clado, data=SG_22_clado)
modF2_22_clado <- lm(SGRclado_T_6.7~clado, data=SG_22_clado)
modF3_22_clado <- lm(SGRclado_T_7.5~clado, data=SG_22_clado)

modF0_25_clado <- lm(SGRclado_T_4.8~clado, data=SG_25_clado)
modF1_25_clado <- lm(SGRclado_T_5.8~clado, data=SG_25_clado)
modF2_25_clado <- lm(SGRclado_T_6.7~clado, data=SG_25_clado)
modF3_25_clado <- lm(SGRclado_T_7.5~clado, data=SG_25_clado)

modF0_28_clado <- lm(SGRclado_T_4.8~clado, data=SG_28_clado)
modF1_28_clado <- lm(SGRclado_T_5.8~clado, data=SG_28_clado)
modF2_28_clado <- lm(SGRclado_T_6.7~clado, data=SG_28_clado)
modF3_28_clado <- lm(SGRclado_T_7.5~clado, data=SG_28_clado)

# Only copepods
modF0_22_copep <- lm(SGRcopep_T_4.8~copep, data=SG_22_copep)  
modF1_22_copep <- lm(SGRcopep_T_5.8~copep, data=SG_22_copep)
modF2_22_copep <- lm(SGRcopep_T_6.7~copep, data=SG_22_copep)
modF3_22_copep <- lm(SGRcopep_T_7.5~copep, data=SG_22_copep)

modF0_25_copep <- lm(SGRcopep_T_4.8~copep, data=SG_25_copep)
modF1_25_copep <- lm(SGRcopep_T_5.8~copep, data=SG_25_copep)
modF2_25_copep <- lm(SGRcopep_T_6.7~copep, data=SG_25_copep)
modF3_25_copep <- lm(SGRcopep_T_7.5~copep, data=SG_25_copep)

modF0_28_copep <- lm(SGRcopep_T_4.8~copep, data=SG_28_copep)
modF1_28_copep <- lm(SGRcopep_T_5.8~copep, data=SG_28_copep)
modF2_28_copep <- lm(SGRcopep_T_6.7~copep, data=SG_28_copep)
modF3_28_copep <- lm(SGRcopep_T_7.5~copep, data=SG_28_copep)

#************************************************************#
# Values at minimum growth rates: (Data for Table S1 in MS)  #
#************************************************************#

# Only Nauplia
# F0
F0naup_min <- c(round(xval (modF0_22_naup, yval=0), 1),
  round(xval (modF0_25_naup, yval=0), 1),
  round(xval (modF0_28_naup, yval=0), 1))

# F1
F1naup_min <- c(round(xval (modF1_22_naup, yval=0), 1),
  round(xval (modF1_25_naup, yval=0), 1),
  round(xval (modF1_28_naup, yval=0), 1))

# F2
F2naup_min <- c(round(xval (modF2_22_naup, yval=0), 1),
  round(xval (modF2_25_naup, yval=0), 1),
  round(xval (modF2_28_naup, yval=0), 1))

# F3
F3naup_min <- c(round(xval (modF3_22_naup, yval=0), 1) ,
  round(xval (modF3_25_naup, yval=0), 1),
  round(xval (modF3_28_naup, yval=0), 1))

# All larval stages together
naup_feed_min <- data.frame(Temps=Temps, Food_item=rep("naup", 3), F0=F0naup_min,
  F1=F1naup_min, F2=F2naup_min, F3=F3naup_min)
  
# Only cladocerans
# F0
F0clado_min <- c(round(xval (modF0_22_clado, yval=0), 1),
  round(xval (modF0_25_clado, yval=0), 1),
  round(xval (modF0_28_clado, yval=0), 1))

# F1
F1clado_min <- c(round(xval (modF1_22_clado, yval=0), 1),
  round(xval (modF1_25_clado, yval=0), 1),
  round(xval (modF1_28_clado, yval=0), 1))

# F2
F2clado_min <- c(round(xval (modF2_22_clado, yval=0), 1),
  round(xval (modF2_25_clado, yval=0), 1),
  round(xval (modF2_28_clado, yval=0), 1))

# F3
F3clado_min <- c(round(xval (modF3_22_clado, yval=0), 1) ,
  round(xval (modF3_25_clado, yval=0), 1),
  round(xval (modF3_28_clado, yval=0), 1))

# All larval stages together
clado_feed_min <- data.frame(Temps=Temps, Food_item=rep("clado", 3), F0=F0clado_min,
  F1=F1clado_min, F2=F2clado_min, F3=F3clado_min)
  
# Only Copeps
# F0
F0copep_min <- c(round(xval (modF0_22_copep, yval=0), 3),
  round(xval (modF0_25_copep, yval=0), 3),
  round(xval (modF0_28_copep, yval=0), 3))

# F1
F1copep_min <- c(round(xval (modF1_22_copep, yval=0), 3),
  round(xval (modF1_25_copep, yval=0), 3),
  round(xval (modF1_28_copep, yval=0), 3))

# F2
F2copep_min <- c(round(xval (modF2_22_copep, yval=0), 3),
  round(xval (modF2_25_copep, yval=0), 3),
  round(xval (modF2_28_copep, yval=0), 3))

# F3
F3copep_min <- c(round(xval (modF3_22_copep, yval=0), 3) ,
  round(xval (modF3_25_copep, yval=0), 3),
  round(xval (modF3_28_copep, yval=0), 3))

# All larval stages together
copep_feed_min <- data.frame(Temps=Temps, Food_item=rep("copep", 3), F0=F0copep_min,
  F1=F1copep_min, F2=F2copep_min, F3=F3copep_min)

# Print min vals (see Min values in Table S1)
naup_feed_min
clado_feed_min
copep_feed_min

#*************************************************************
# Values at maxium growth rates: (Data for Table S1 in MS)
#*************************************************************
# Only nauplia
# F0
F0naup_max <- c(round(xval (modF0_22_naup, yval=(SGRlib_T[1]*15)), 1),
  round(xval (modF0_25_naup, yval=(SGRlib_T[2]*15)), 1),
  round(xval (modF0_28_naup, yval=(SGRlib_T[3]*15)), 1))

# F1
F1naup_max <- c(round(xval (modF1_22_naup, yval=(SGRlib_T[1]*15)), 1),
  round(xval (modF1_25_naup, yval=(SGRlib_T[2]*15)), 1),
  round(xval (modF1_28_naup, yval=(SGRlib_T[3]*15)), 1))

# F2
F2naup_max <- c(round(xval (modF2_22_naup, yval=(SGRlib_T[1]*15)), 1),
  round(xval (modF2_25_naup, yval=(SGRlib_T[2]*15)), 1),
  round(xval (modF2_28_naup, yval=(SGRlib_T[3]*15)), 1))

# F3
F3naup_max <- c(round(xval (modF3_22_naup, yval=(SGRlib_T[1]*15)), 1),
  round(xval (modF3_25_naup, yval=(SGRlib_T[2]*15)), 1),
  round(xval (modF3_28_naup, yval=(SGRlib_T[3]*15)), 1))

  # All larval stages together
naup_feed_max <- data.frame(Temps=Temps, Food_item=rep("naup", 3), F0=F0naup_max,
  F1=F1naup_max, F2=F2naup_max, F3=F3naup_max)

# Only cladoceran
# F0
F0clado_max <- c(round(xval (modF0_22_clado, yval=(SGRlib_T[1]*15)), 1),
  round(xval (modF0_25_clado, yval=(SGRlib_T[2]*15)), 1),
  round(xval (modF0_28_clado, yval=(SGRlib_T[3]*15)), 1))

# F1
F1clado_max <- c(round(xval (modF1_22_clado, yval=(SGRlib_T[1]*15)), 1),
  round(xval (modF1_25_clado, yval=(SGRlib_T[2]*15)), 1),
  round(xval (modF1_28_clado, yval=(SGRlib_T[3]*15)), 1))

# F2
F2clado_max <- c(round(xval (modF2_22_clado, yval=(SGRlib_T[1]*15)), 1),
  round(xval (modF2_25_clado, yval=(SGRlib_T[2]*15)), 1),
  round(xval (modF2_28_clado, yval=(SGRlib_T[3]*15)), 1))

# F3
F3clado_max <- c(round(xval (modF3_22_clado, yval=(SGRlib_T[1]*15)), 1) ,
  round(xval (modF3_25_clado, yval=(SGRlib_T[2]*15)), 1),
  round(xval (modF3_28_clado, yval=(SGRlib_T[3]*15)), 1))

# All larval stages together
clado_feed_max <- data.frame(Temps=Temps, Food_item=rep("clado", 3), F0=F0clado_max,
  F1=F1clado_max, F2=F2clado_max, F3=F3clado_max)

# Only copepods
# F0
F0copep_max <- c(round(xval (modF0_22_copep, yval=(SGRlib_T[1]*15)), 3),
  round(xval (modF0_25_copep, yval=(SGRlib_T[2]*15)), 3),
  round(xval (modF0_28_copep, yval=(SGRlib_T[3]*15)), 3))

# F1
F1copep_max <- c(round(xval (modF1_22_copep, yval=(SGRlib_T[1]*15)), 1),
  round(xval (modF1_25_copep, yval=(SGRlib_T[2]*15)), 1),
  round(xval (modF1_28_copep, yval=(SGRlib_T[3]*15)), 1))

# F2
F2copep_max <- c(round(xval (modF2_22_copep, yval=(SGRlib_T[1]*15)), 3),
  round(xval (modF2_25_copep, yval=(SGRlib_T[2]*15)), 3),
  round(xval (modF2_28_copep, yval=(SGRlib_T[3]*15)), 3))

# F3
F3copep_max <- c(round(xval (modF3_22_copep, yval=(SGRlib_T[1]*15)), 3) ,
  round(xval (modF3_25_copep, yval=(SGRlib_T[2]*15)), 3),
  round(xval (modF3_28_copep, yval=(SGRlib_T[3]*15)), 3))

# All larval stages together
copep_feed_max <- data.frame(Temps=Temps, Food_item=rep("copep", 3), F0=F0copep_max,
  F1=F1copep_max, F2=F2copep_max, F3=F3copep_max)

# Print max vals (see Max values in Table S1)
naup_feed_max
clado_feed_max
copep_feed_max


############################# Plotting Figure 3 ################################

#********************************
# 1) Nauplia, Figure 3a in MS
#********************************
dev.new(); 
library(grid)
maxX_nauT <- 30000
par(mar=c(7.5,5.5,1,6.5), oma=c(0,0,0,0))
plot(SGRnaup_T_4.8~naup, data=SG_22_naup, type="n", 
  xlim=c(0, maxX_nauT),
  ylim=c(0, maxY_T),
  xaxs="i", yaxs="i", 
  cex.lab=1.5, cex.axis=1.2, 
  lwd=2,
  ylab="",
  xlab="", 
  las=1, col=mycols[[1]][1])
title(ylab=substitute(paste("Specific growth rate,  ", italic("SGR"), sep="")), line=4, cex.lab=1.5) 
mtext(expression("(N m"^-3*")"), 1, line=1, at=32500, col="black", cex=1.2, adj=0)
grid.text("a", x = unit(0.2, "npc"), y = unit(0.95, "npc"), gp = gpar(fontsize = 20))

#*****
# F0
#*****
# T: 22ºC
tmp <- predict(modF0_22_naup, data.frame(naup=c(naup_feed_max$F0[1], naup_feed_min$F0[1])))  
data_1 <- data.frame(SGRnaup_T_4.8=tmp, naup=c(naup_feed_max$F0[1], naup_feed_min$F0[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][1], lwd=2)
rm(tmp, data_1)

# T: 25ºC
tmp <- predict(modF0_25_naup, data.frame(naup=c(naup_feed_max$F0[2], naup_feed_min$F0[2])))  
data_1 <- data.frame(SGRnaup_T_4.8=tmp, naup=c(naup_feed_max$F0[2], naup_feed_min$F0[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][1], lwd=2)
rm(tmp, data_1)

# T: 28ºC
tmp <- predict(modF0_28_naup, data.frame(naup=c(naup_feed_max$F0[3], naup_feed_min$F0[3])))  
data_1 <- data.frame(SGRnaup_T_4.8=tmp, naup=c(naup_feed_max$F0[3], naup_feed_min$F0[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][1], lwd=2)
rm(tmp, data_1)

#*****
# F1
#*****
# T: 22ºC
tmp <- predict(modF1_22_naup, data.frame(naup=c(naup_feed_max$F1[1], naup_feed_min$F1[1])))  
data_1 <- data.frame(SGRnaup_T_5.8=tmp, naup=c(naup_feed_max$F1[1], naup_feed_min$F1[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][2], lwd=2)
rm(tmp, data_1)

# T: 25ºC  
tmp <- predict(modF1_25_naup, data.frame(naup=c(naup_feed_max$F1[2], naup_feed_min$F1[2])))  
data_1 <- data.frame(SGRnaup_T_5.8=tmp, naup=c(naup_feed_max$F1[2], naup_feed_min$F1[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][2], lwd=2)
rm(tmp, data_1)  

# T: 28ºC 
tmp <- predict(modF1_28_naup, data.frame(naup=c(naup_feed_max$F1[3], naup_feed_min$F1[3])))  
data_1 <- data.frame(SGRnaup_T_5.8=tmp, naup=c(naup_feed_max$F1[3], naup_feed_min$F1[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][2], lwd=2)
rm(tmp, data_1)

#*****
# F2
#*****
# T: 22ºC
tmp <- predict(modF2_22_naup, data.frame(naup=c(naup_feed_max$F2[1], naup_feed_min$F2[1])))  
data_1 <- data.frame(SGRnaup_T_6.7=tmp, naup=c(naup_feed_max$F2[1], naup_feed_min$F2[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][3], lwd=2)
rm(tmp, data_1)

# T: 25ºC
tmp <- predict(modF2_25_naup, data.frame(naup=c(naup_feed_max$F2[2], naup_feed_min$F2[2])))  
data_1 <- data.frame(SGRnaup_T_6.7=tmp, naup=c(naup_feed_max$F2[2], naup_feed_min$F2[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][3], lwd=2)
rm(tmp, data_1)

# T: 28ºC
tmp <- predict(modF2_28_naup, data.frame(naup=c(naup_feed_max$F2[3], naup_feed_min$F2[3])))  
data_1 <- data.frame(SGRnaup_T_6.7=tmp, naup=c(naup_feed_max$F2[3], naup_feed_min$F2[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][3], lwd=2)
rm(tmp, data_1)   

#*****
# F3
#*****
# T: 22ºC
tmp <- predict(modF3_22_naup, data.frame(naup=c(naup_feed_max$F3[1], naup_feed_min$F3[1])))  
data_1 <- data.frame(SGRnaup_T_7.5=tmp, naup=c(naup_feed_max$F3[1], naup_feed_min$F3[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][4], lwd=2)
rm(tmp, data_1)

# T: 25ºC
tmp <- predict(modF3_25_naup, data.frame(naup=c(naup_feed_max$F3[2], naup_feed_min$F3[2])))  
data_1 <- data.frame(SGRnaup_T_7.5=tmp, naup=c(naup_feed_max$F3[2], naup_feed_min$F3[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][4], lwd=2)
rm(tmp, data_1)

# T: 28ºC
tmp <- predict(modF3_28_naup, data.frame(naup=c(naup_feed_max$F3[3], naup_feed_min$F3[3])))  
data_1 <- data.frame(SGRnaup_T_7.5=tmp, naup=c(naup_feed_max$F3[3], naup_feed_min$F3[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][4], lwd=2)
rm(tmp, data_1)

# SGR at libitum
abline(h=SGRlib_T[1]*15, col="grey64", lty="dashed", lwd=2)
abline(h=SGRlib_T[2]*15, col="#565d61", lty="dashed", lwd=2)
abline(h=SGRlib_T[3]*15, col="white", lwd=4) # white line just for visual purposes
abline(h=SGRlib_T[3]*15, col="#000000", lty="dashed", lwd=2)

labsN <- c(0, 5000, 10000, 15000, 20000, 25000, 30000)
DwNaup = 0.11*1E-03                
labsW <- labsN*DwNaup*1000
axis(1, labsN, labels=labsW, line=2.5, col="grey50", col.ticks="grey50", col.axis="grey50", cex.lab=1.5, cex.axis=1.2)
mtext(expression("(µg m"^-3*")"), 1, line=3.5, at=32500, col="grey50", cex=1.2, adj=0)
mtext("Nauplia density", 1, line=6, at=15000, col="black", cex=1.8)


#********************************
# 2) Cladocerans, Figure 3b in MS
#********************************
dev.new(); 
library(grid)
maxX_cladT <- max(SG_22_clado$clado, SG_25_clado$clado, SG_28_clado$clado)
maxX_cladT <- 40
par(mar=c(7.5,5.5,1,6.5), oma=c(0,0,0,0))
plot(SGRclado_T_4.8~clado, data=SG_22_clado, 
  type="n", 
  xlim=c(0, maxX_cladT),
  ylim=c(0, maxY_T),
  xaxs="i", yaxs="i", 
  cex.lab=1.5, cex.axis=1.2,
  lwd=2,
  ylab="", 
  xlab="",
  las=1, col=mycols[[1]][1])
title(ylab=substitute(paste("Specific growth rate,  ", italic("SGR"), sep="")), line=4, cex.lab=1.5) 
mtext(expression("(N m"^-3*")"), 1, line=1, at=42.500, col="black", cex=1.2, adj=0)
grid.text("b", x = unit(0.2, "npc"), y = unit(0.95, "npc"), gp = gpar(fontsize = 20))

#*****
# F0
#*****
# T: 22ºC
tmp <- predict(modF0_22_clado, data.frame(clado=c(clado_feed_max$F0[1], clado_feed_min$F0[1])))  
data_1 <- data.frame(SGRclado_T_4.8=tmp, clado=c(clado_feed_max$F0[1], clado_feed_min$F0[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][1], lwd=2)
rm(tmp, data_1)

# T: 25ºC
tmp <- predict(modF0_25_clado, data.frame(clado=c(clado_feed_max$F0[2], clado_feed_min$F0[2])))  
data_1 <- data.frame(SGRclado_T_4.8=tmp, clado=c(clado_feed_max$F0[2], clado_feed_min$F0[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][1], lwd=2)
rm(tmp, data_1)

# T: 28ºC
tmp <- predict(modF0_28_clado, data.frame(clado=c(clado_feed_max$F0[3], clado_feed_min$F0[3])))  
data_1 <- data.frame(SGRclado_T_4.8=tmp, clado=c(clado_feed_max$F0[3], clado_feed_min$F0[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][1], lwd=2)
rm(tmp, data_1)

#*****
# F1
#*****
# T: 22ºC
tmp <- predict(modF1_22_clado, data.frame(clado=c(clado_feed_max$F1[1], clado_feed_min$F1[1])))  
data_1 <- data.frame(SGRclado_T_5.8=tmp, clado=c(clado_feed_max$F1[1], clado_feed_min$F1[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][2], lwd=2)
rm(tmp, data_1)

# T: 25ºC  
tmp <- predict(modF1_25_clado, data.frame(clado=c(clado_feed_max$F1[2], clado_feed_min$F1[2])))  
data_1 <- data.frame(SGRclado_T_5.8=tmp, clado=c(clado_feed_max$F1[2], clado_feed_min$F1[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][2], lwd=2)
rm(tmp, data_1)  

# T: 28ºC 
tmp <- predict(modF1_28_clado, data.frame(clado=c(clado_feed_max$F1[3], clado_feed_min$F1[3])))  
data_1 <- data.frame(SGRclado_T_5.8=tmp, clado=c(clado_feed_max$F1[3], clado_feed_min$F1[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][2], lwd=2)
rm(tmp, data_1)

#*****
# F2
#*****
# T: 22ºC
tmp <- predict(modF2_22_clado, data.frame(clado=c(clado_feed_max$F2[1], clado_feed_min$F2[1])))  
data_1 <- data.frame(SGRclado_T_6.7=tmp, clado=c(clado_feed_max$F2[1], clado_feed_min$F2[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][3], lwd=2)
rm(tmp, data_1)

# T: 25ºC
tmp <- predict(modF2_25_clado, data.frame(clado=c(clado_feed_max$F2[2], clado_feed_min$F2[2])))  
data_1 <- data.frame(SGRclado_T_6.7=tmp, clado=c(clado_feed_max$F2[2], clado_feed_min$F2[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][3], lwd=2)
rm(tmp, data_1)

# T: 28ºC
tmp <- predict(modF2_28_clado, data.frame(clado=c(clado_feed_max$F2[3], clado_feed_min$F2[3])))  
data_1 <- data.frame(SGRclado_T_6.7=tmp, clado=c(clado_feed_max$F2[3], clado_feed_min$F2[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][3], lwd=2)
rm(tmp, data_1)   

#*****
# F3
#*****
# T: 22ºC
tmp <- predict(modF3_22_clado, data.frame(clado=c(clado_feed_max$F3[1], clado_feed_min$F3[1])))  
data_1 <- data.frame(SGRclado_T_7.5=tmp, clado=c(clado_feed_max$F3[1], clado_feed_min$F3[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][4], lwd=2)
rm(tmp, data_1)

# T: 25ºC
tmp <- predict(modF3_25_clado, data.frame(clado=c(clado_feed_max$F3[2], clado_feed_min$F3[2])))  
data_1 <- data.frame(SGRclado_T_7.5=tmp, clado=c(clado_feed_max$F3[2], clado_feed_min$F3[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][4], lwd=2)
rm(tmp, data_1)

tmp <- predict(modF3_28_clado, data.frame(clado=c(clado_feed_max$F3[3], clado_feed_min$F3[3])))  
data_1 <- data.frame(SGRclado_T_7.5=tmp, clado=c(clado_feed_max$F3[3], clado_feed_min$F3[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][4], lwd=2)
rm(tmp, data_1)
 
# SGR at libitum
abline(h=SGRlib_T[1]*15, col="grey64", lty="dashed", lwd=2)
abline(h=SGRlib_T[2]*15, col="#565d61", lty="dashed", lwd=2)
abline(h=SGRlib_T[3]*15, col="white", lwd=4) # white line just for visual purposes
abline(h=SGRlib_T[3]*15, col="#000000", lty="dashed", lwd=2)

labsN_clad <- c(0, 10, 20, 30, 40)
DwClad = 3.15*1E-03  
labsW_clad <- round(labsN_clad*DwClad*1000, 1)
axis(1, labsN_clad, labels=labsW_clad, line=2.5, col="grey50", col.ticks="grey50", col.axis="grey50", cex.lab=1.5, cex.axis=1.2)
mtext(expression("(µg m"^-3*")"), 1, line=3.5, at=42.500, col="grey50", cex=1.2, adj=0)
mtext("Cladocera density", 1, line=6, at=20.000, col="black", cex=1.8)

#******************************
# 3) Copepods, Figure 3a in MS   
#******************************
dev.new(); 
library(grid)
par(mar=c(7.5,5.5,1,6.5), oma=c(0,0,0,0))
maxX_cop <- 7
plot(SGRcopep_T_4.8~copep, data=SG_22_copep, 
  type="n", 
  xlim=c(0, maxX_cop),
  ylim=c(0, maxY_T),
  xaxs="i", yaxs="i", 
  cex.lab=1.5, cex.axis=1.2, 
  lwd=2,
  ylab="", 
  xlab="",
  las=1, col=mycols[[1]][1])
title(ylab=substitute(paste("Specific growth rate,  ", italic("SGR"), sep="")), line=4, cex.lab=1.5) 
mtext(expression("(N m"^-3*")"), 1, line=1, at=7.2500, col="black", cex=1.2, adj=0)
grid.text("c", x = unit(0.2, "npc"), y = unit(0.95, "npc"), gp = gpar(fontsize = 20))

#*****
# F0
#*****
# T: 22ºC
tmp <- predict(modF0_22_copep, data.frame(copep=c(copep_feed_max$F0[1], copep_feed_min$F0[1])))  
data_1 <- data.frame(SGRcopep_T_4.8=tmp, copep=c(copep_feed_max$F0[1], copep_feed_min$F0[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][1], lwd=2)
rm(tmp, data_1)

# T: 25ºC
tmp <- predict(modF0_25_copep, data.frame(copep=c(copep_feed_max$F0[2], copep_feed_min$F0[2])))  
data_1 <- data.frame(SGRcopep_T_4.8=tmp, copep=c(copep_feed_max$F0[2], copep_feed_min$F0[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][1], lwd=2)
rm(tmp, data_1)

# T: 28ºC
tmp <- predict(modF0_28_copep, data.frame(copep=c(copep_feed_max$F0[3], copep_feed_min$F0[3])))  
data_1 <- data.frame(SGRcopep_T_4.8=tmp, copep=c(copep_feed_max$F0[3], copep_feed_min$F0[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][1], lwd=2)
rm(tmp, data_1)

#*****
# F1
#*****
# T: 22ºC
tmp <- predict(modF1_22_copep, data.frame(copep=c(copep_feed_max$F1[1], copep_feed_min$F1[1])))  
data_1 <- data.frame(SGRcopep_T_5.8=tmp, copep=c(copep_feed_max$F1[1], copep_feed_min$F1[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][2], lwd=2)
rm(tmp, data_1)

# T: 25ºC  
tmp <- predict(modF1_25_copep, data.frame(copep=c(copep_feed_max$F1[2], copep_feed_min$F1[2])))  
data_1 <- data.frame(SGRcopep_T_5.8=tmp, copep=c(copep_feed_max$F1[2], copep_feed_min$F1[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][2], lwd=2)
rm(tmp, data_1)  

# T: 28ºC 
tmp <- predict(modF1_28_copep, data.frame(copep=c(copep_feed_max$F1[3], copep_feed_min$F1[3])))  
data_1 <- data.frame(SGRcopep_T_5.8=tmp, copep=c(copep_feed_max$F1[3], copep_feed_min$F1[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][2], lwd=2)
rm(tmp, data_1)

#*****
# F2
#*****
# T: 22ºC
tmp <- predict(modF2_22_copep, data.frame(copep=c(copep_feed_max$F2[1], copep_feed_min$F2[1])))  
data_1 <- data.frame(SGRcopep_T_6.7=tmp, copep=c(copep_feed_max$F2[1], copep_feed_min$F2[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][3], lwd=2)
rm(tmp, data_1)

# T: 25ºC
tmp <- predict(modF2_25_copep, data.frame(copep=c(copep_feed_max$F2[2], copep_feed_min$F2[2])))  
data_1 <- data.frame(SGRcopep_T_6.7=tmp, copep=c(copep_feed_max$F2[2], copep_feed_min$F2[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][3], lwd=2)
rm(tmp, data_1)

# T: 28ºC
tmp <- predict(modF2_28_copep, data.frame(copep=c(copep_feed_max$F2[3], copep_feed_min$F2[3])))  
data_1 <- data.frame(SGRcopep_T_6.7=tmp, copep=c(copep_feed_max$F2[3], copep_feed_min$F2[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][3], lwd=2)
rm(tmp, data_1)   

#*****
# F3
#*****
# T: 22ºC
tmp <- predict(modF3_22_copep, data.frame(copep=c(copep_feed_max$F3[1], copep_feed_min$F3[1])))  
data_1 <- data.frame(SGRcopep_T_7.5=tmp, copep=c(copep_feed_max$F3[1], copep_feed_min$F3[1]))
lines(data_1[,1]~data_1[,2], col=mycols[[1]][4], lwd=2)
rm(tmp, data_1)

# T: 25ºC
tmp <- predict(modF3_25_copep, data.frame(copep=c(copep_feed_max$F3[2], copep_feed_min$F3[2])))  
data_1 <- data.frame(SGRcopep_T_7.5=tmp, copep=c(copep_feed_max$F3[2], copep_feed_min$F3[2]))
lines(data_1[,1]~data_1[,2], col=mycols[[2]][4], lwd=2)
rm(tmp, data_1)

tmp <- predict(modF3_28_copep, data.frame(copep=c(copep_feed_max$F3[3], copep_feed_min$F3[3])))  
data_1 <- data.frame(SGRcopep_T_7.5=tmp, copep=c(copep_feed_max$F3[3], copep_feed_min$F3[3]))
lines(data_1[,1]~data_1[,2], col=mycols[[3]][4], lwd=2)
rm(tmp, data_1)

# SGR at libitum
abline(h=SGRlib_T[1]*15, col="grey64", lty="dashed", lwd=2)
abline(h=SGRlib_T[2]*15, col="#565d61", lty="dashed", lwd=2)
abline(h=SGRlib_T[3]*15, col="white", lwd=4) # white line just for visual purposes
abline(h=SGRlib_T[3]*15, col="#000000", lty="dashed", lwd=2)

labsN_copep <- c(0, 1, 2, 3, 4, 5, 6, 7)
DwCopep = 11.1*1E-03               
labsW_copep <- round(labsN_copep*DwCopep*1000, 1)
axis(1, labsN_copep, labels=labsW_copep, line=2.5, col="grey50", col.ticks="grey50", col.axis="grey50", cex.lab=1.5, cex.axis=1.2)
mtext(expression("(µg m"^-3*")"), 1, line=3.5, at=7.3500, col="grey50", cex=1.2, adj=0)

mtext("Copepod density", 1, line=6, at=3.500, col="black", cex=1.8)

############################ End of script #################################
